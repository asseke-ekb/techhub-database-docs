# TechHub - Описание сущностей

## Сводная таблица ключевых сущностей

| Сущность | Таблица | Записей | Описание | PK |
|----------|---------|---------|----------|-----|
| Пользователь | `account_user` | 54,063 | Физическое лицо в системе | id |
| Компания | `account_company` | 6,639 | Юридическое лицо или ИП | id |
| Связь User-Company | `account_usercompany` | 4,536 | Кто в какой компании работает | id |
| Организация | `core_organization` | 45 | Организации-партнёры (Астана Хаб и др.) | code |
| Услуга | `service_service` | 310 | Справочник услуг хаба | id |
| Заявка на услугу | `service_servicerequest` | 56,000+ | Заявки компаний на услуги | id |
| Форма заявки | `service_hubform` | 282 | Шаблоны форм для заявок | id |
| Данные формы | `service_hubformdata` | 62,000+ | Заполненные данные форм | id |
| Событие | `core_event` | 1,400+ | Мероприятия платформы | id |
| Вакансия | `core_vacancy` | 1,200+ | Вакансии от компаний | id |
| Блог | `core_blog` | 1,800+ | Публикации пользователей | id |
| Комментарий | `core_comment` | 2,500+ | Комментарии к контенту | id |
| Бронирование | `booking_booking` | 8,600+ | Брони переговорок | id |
| Комната | `booking_room` | 16 | Справочник комнат | id |

---

## 1. Пользователь (account_user)

### Бизнес-описание

Физическое лицо, зарегистрированное на платформе TechHub. Может быть:
- Обычным пользователем
- Сотрудником/владельцем компании
- Экспертом для оценки заявок
- Модератором контента
- Администратором системы

### Ключевые атрибуты

| Атрибут | Тип | Обязат. | Описание | Пример |
|---------|-----|---------|----------|--------|
| `id` | integer | Да | Первичный ключ | 12345 |
| `email` | varchar(400) | Нет | Email (уникальный) | user@example.com |
| `phone` | varchar(100) | Да | Телефон (уникальный) | +77001234567 |
| `iin` | varchar(100) | Нет | ИИН (12 цифр) | 900101350123 |
| `first_name` | varchar(400) | Да | Имя | Алмас |
| `last_name` | varchar(400) | Да | Фамилия | Касымов |
| `role` | varchar(50) | Да | Роль в системе | user, admin, expert |
| `is_active` | boolean | Да | Аккаунт активен | true |
| `blocked` | boolean | Да | Заблокирован | false |
| `email_verified` | boolean | Да | Email подтверждён | true |
| `phone_verified` | boolean | Да | Телефон подтверждён | true |
| `company_id` | integer | Нет | FK на основную компанию | 1000 |
| `organization_id` | varchar(20) | Нет | FK на организацию (для сотрудников хаба) | astanahub |
| `data` | jsonb | Да | Дополнительные данные профиля | {"goals": [...]} |
| `tags` | jsonb | Да | Теги пользователя | {"article": true} |
| `created_at` | timestamp | Да | Дата регистрации | 2024-01-15 10:30:00 |

### Внешние ключи

| Поле | Ссылается на | Описание |
|------|--------------|----------|
| `company_id` | `account_company.id` | Основная компания пользователя |
| `organization_id` | `core_organization.code` | Организация (для сотрудников) |

### Бизнес-правила

- **BR-U001:** Телефон должен быть уникальным в системе
- **BR-U002:** Email должен быть уникальным (если указан)
- **BR-U003:** ИИН должен содержать ровно 12 цифр
- **BR-U004:** Пользователь может быть связан с несколькими компаниями через `account_usercompany`

---

## 2. Компания (account_company)

### Бизнес-описание

Юридическое лицо или индивидуальный предприниматель, зарегистрированный на платформе. Может иметь различные статусы:
- Стартап (в реестре стартапов)
- IT-компания (аккредитованная)
- Резидент технопарка
- Корпоративный партнёр

### Ключевые атрибуты

| Атрибут | Тип | Обязат. | Описание | Пример |
|---------|-----|---------|----------|--------|
| `id` | integer | Да | Первичный ключ | 1000 |
| `tin` | varchar(12) | Нет | БИН/ИИН (12 цифр, уникальный) | 123456789012 |
| `name` | varchar(1000) | Да | Полное название | ТОО "Инновации" |
| `short_name` | varchar(200) | Да | Краткое название | Инновации |
| `company_type` | varchar(30) | Да | Тип ОПФ | law, ip, unknown |
| `status` | varchar(20) | Да | Статус | active, blocked |
| `verified` | boolean | Да | Прошла верификацию | true |
| `address` | varchar(2000) | Да | Юридический адрес | г. Астана, ул. Мангилик Ел |
| `email` | varchar(200) | Да | Email компании | info@company.kz |
| `phone` | varchar(30) | Да | Телефон | +77172123456 |
| `website` | varchar(1000) | Да | Веб-сайт | https://company.kz |
| `description` | text | Да | Описание деятельности | Разработка ПО... |
| `director_first_name` | varchar(200) | Да | Имя директора | Алмас |
| `director_last_name` | varchar(200) | Да | Фамилия директора | Касымов |
| `author_id` | integer | Нет | FK на создателя | 12345 |
| `created_at` | timestamp | Да | Дата регистрации | 2024-01-15 |

### Теги компании (JSONB)

Компания может иметь несколько тегов одновременно:

| Поле | Описание | Что означает |
|------|----------|--------------|
| `tag_startup` | Стартап | Компания в реестре стартапов |
| `tag_it_company` | IT-компания | Аккредитованная IT-компания |
| `tag_techpark` | Резидент | Резидент технопарка Astana Hub |
| `tag_corp_partner` | Корп. партнёр | Корпоративный партнёр |
| `tag_nii` | НИИ | Научно-исследовательский институт |
| `tag_ts_member` | Член ТС | Член Tech Summit |

**Структура тега:**
```json
{
  "status": "active",
  "date_from": "2024-01-15",
  "date_to": null,
  "data": {}
}
```

### Бизнес-правила

- **BR-C001:** БИН должен содержать 12 цифр и быть уникальным
- **BR-C002:** Компания считается верифицированной после прохождения аккредитации
- **BR-C003:** Статус "blocked" блокирует все операции компании

---

## 3. Связь Пользователь-Компания (account_usercompany)

### Бизнес-описание

Определяет, какой пользователь работает в какой компании и с какой ролью. Один пользователь может быть связан с несколькими компаниями (например, быть владельцем одной и консультантом другой).

### Атрибуты

| Атрибут | Тип | Обязат. | Описание | Пример |
|---------|-----|---------|----------|--------|
| `id` | integer | Да | PK | 5000 |
| `user_id` | integer | Да | FK на пользователя | 12345 |
| `company_id` | integer | Да | FK на компанию | 1000 |
| `role` | varchar(20) | Да | Роль в компании | owner, member, advisor |
| `verified` | boolean | Да | Связь подтверждена | true |

### Роли в компании

| Код | Название | Описание |
|-----|----------|----------|
| `owner` | Владелец | Владелец компании (только один на компанию) |
| `member` | Сотрудник | Сотрудник компании |
| `advisor` | Консультант | Консультант/Советник |

### Бизнес-правила

- **BR-UC001:** У компании может быть только один owner
- **BR-UC002:** Уникальная комбинация user_id + company_id

---

## 4. Услуга (service_service)

### Бизнес-описание

Справочник государственных и внутренних услуг платформы. Каждая услуга имеет свою форму для заполнения.

### Атрибуты

| Атрибут | Тип | Обязат. | Описание | Пример |
|---------|-----|---------|----------|--------|
| `id` | integer | Да | PK | 10 |
| `code` | varchar | Да | Уникальный код услуги | accreditation |
| `data` | jsonb | Да | Данные (название, описание) | {"name": {"ru": "..."}} |
| `organization_id` | varchar(20) | Нет | FK на организацию-владельца | astanahub |
| `hub_form_id` | integer | Нет | FK на форму заявки | 100 |

### Примеры услуг

| Код | Название |
|-----|----------|
| `accreditation` | Аккредитация IT-компании |
| `startup_register` | Реестр стартапов |
| `techorda_request` | Заявка на TechOrda |
| `seedmoney` | Грант Seed Money |
| `mat_pass` | Материальный пропуск |
| `techpark_register` | Резидентство технопарка |
| `visa_support` | Визовая поддержка |

---

## 5. Заявка на услугу (service_servicerequest)

### Бизнес-описание

Заявка компании или пользователя на получение государственной услуги или сервиса хаба. Проходит через несколько этапов: черновик → отправлена → модерация → экспертиза → результат.

### Ключевые атрибуты

| Атрибут | Тип | Обязат. | Описание | Пример |
|---------|-----|---------|----------|--------|
| `id` | integer | Да | PK | 50000 |
| `service_id` | integer | Да | FK на услугу | 10 |
| `status` | varchar(20) | Да | Статус заявки | draft, sent, success |
| `author_id` | integer | Да | FK на автора заявки | 12345 |
| `company_id` | integer | Нет | FK на компанию-заявителя | 1000 |
| `assignee_id` | integer | Нет | FK на исполнителя | 100 |
| `expert_id` | integer | Нет | FK на эксперта | 200 |
| `hub_form_data_id` | integer | Нет | FK на данные формы | 30000 |
| `parent_id` | integer | Нет | FK на родительскую заявку | null |
| `data` | jsonb | Да | Дополнительные данные | {"signatures": [...]} |
| `created_at` | timestamp | Да | Дата создания | 2024-12-01 |
| `updated_at` | timestamp | Да | Дата обновления | 2024-12-03 |

### Жизненный цикл заявки

```
┌─────────┐     отправить     ┌─────────┐     проверка      ┌──────────┐
│  DRAFT  │──────────────────►│  SENT   │──────────────────►│ APPROVED │
│Черновик │                   │Отправлена│                   │ Одобрена │
└─────────┘                   └────┬────┘                   └────┬─────┘
                                   │                              │
                             доработка                        экспертиза
                                   │                              │
                                   ▼                              ▼
                            ┌───────────┐                  ┌──────────┐
                            │CORRECTION │                  │ SUCCESS  │
                            │На доработке│                  │Завершена │
                            └───────────┘                  └──────────┘
                                   │
                                   │                       ┌──────────┐
                                   └──────────────────────►│  REJECT  │
                                                           │Отклонена │
                                                           └──────────┘
```

### Бизнес-правила

- **BR-SR001:** Заявка создаётся в статусе "draft"
- **BR-SR002:** Переход в "sent" только после заполнения обязательных полей
- **BR-SR003:** Только модератор может изменить статус на "approved" или "reject"

---

## 6. Событие (core_event)

### Бизнес-описание

Мероприятие на платформе: конференция, митап, хакатон, вебинар, воркшоп и др. Может быть организовано компанией или хабом.

### Ключевые атрибуты

| Атрибут | Тип | Обязат. | Описание | Пример |
|---------|-----|---------|----------|--------|
| `id` | integer | Да | PK | 500 |
| `title` | jsonb | Да | Название (ru/kk/en) | {"ru": "Конференция AI"} |
| `content` | jsonb | Да | Описание (ru/kk/en) | {"ru": "<p>...</p>"} |
| `slug` | varchar(250) | Да | URL-slug (уникальный) | conference-ai-2024 |
| `status` | varchar(20) | Да | Статус | draft, sent, success |
| `event_type` | varchar(20) | Нет | Тип события | open_event, closed_event |
| `event_format` | varchar(20) | Да | Формат | astanahub, online, hybrid |
| `datetime_start` | timestamp | Нет | Дата и время начала | 2024-12-15 10:00:00 |
| `datetime_end` | timestamp | Нет | Дата и время окончания | 2024-12-15 18:00:00 |
| `published` | boolean | Да | Опубликовано | true |
| `view_count` | integer | Да | Количество просмотров | 1500 |
| `author_id` | integer | Да | FK на автора | 12345 |
| `company_id` | integer | Нет | FK на компанию-организатора | 1000 |
| `organization_id` | varchar(20) | Нет | FK на организацию | astanahub |

### Бизнес-правила

- **BR-E001:** Событие публикуется только после модерации (status = success)
- **BR-E002:** datetime_end должен быть больше datetime_start

---

## 7. Вакансия (core_vacancy)

### Бизнес-описание

Вакансия от компании-резидента хаба. Содержит требования, условия и зарплатную вилку.

### Ключевые атрибуты

| Атрибут | Тип | Обязат. | Описание | Пример |
|---------|-----|---------|----------|--------|
| `id` | integer | Да | PK | 300 |
| `title` | jsonb | Да | Название (ru/kk/en) | {"ru": "Python Developer"} |
| `description` | jsonb | Да | Описание | {"ru": "Требования..."} |
| `status` | varchar(20) | Да | Статус | draft, sent, success |
| `vacancy_type` | varchar(20) | Нет | Тип занятости | fulltime, parttime |
| `salary_min` | integer | Нет | Мин. зарплата (KZT) | 500000 |
| `salary_max` | integer | Нет | Макс. зарплата (KZT) | 1000000 |
| `published` | boolean | Да | Опубликовано | true |
| `author_id` | integer | Да | FK на автора | 12345 |
| `company_id` | integer | Нет | FK на компанию | 1000 |
| `city_id` | integer | Нет | FK на город | 1 |

### Бизнес-правила

- **BR-V001:** salary_max >= salary_min
- **BR-V002:** Вакансия публикуется только от верифицированной компании

---

## 8. Бронирование (booking_booking)

### Бизнес-описание

Бронирование переговорной комнаты или другого ресурса хаба.

### Ключевые атрибуты

| Атрибут | Тип | Обязат. | Описание | Пример |
|---------|-----|---------|----------|--------|
| `id` | integer | Да | PK | 5000 |
| `status` | varchar(20) | Да | Статус | active, finished, deactivated |
| `title` | varchar(100) | Да | Название встречи | Совещание по проекту |
| `start` | timestamp | Да | Время начала | 2024-12-15 10:00:00 |
| `end` | timestamp | Да | Время окончания | 2024-12-15 11:00:00 |
| `room_id` | integer | Да | FK на комнату | 10 |
| `author_id` | integer | Да | FK на автора брони | 12345 |
| `company_id` | integer | Нет | FK на компанию | 1000 |
| `full_name` | varchar(200) | Да | ФИО контактного лица | Алмас Касымов |
| `email` | varchar(200) | Да | Email | user@example.com |
| `phone` | varchar(30) | Да | Телефон | +77001234567 |

### Бизнес-правила

- **BR-B001:** Время окончания должно быть больше времени начала
- **BR-B002:** Нельзя создать пересекающиеся брони для одной комнаты
- **BR-B003:** Бронь можно отменить (deactivated) только до её начала

---

## 9. Комментарий (core_comment)

### Бизнес-описание

Комментарии к различным сущностям (блоги, события, вакансии). Используется полиморфная связь через поля source + primary_key.

### Атрибуты

| Атрибут | Тип | Обязат. | Описание | Пример |
|---------|-----|---------|----------|--------|
| `id` | integer | Да | PK | 2000 |
| `message` | text | Да | Текст комментария | Отличная статья! |
| `source` | varchar(50) | Да | Тип сущности | blog, event, vacancy |
| `primary_key` | varchar(20) | Да | ID сущности | 800 |
| `user_id` | integer | Да | FK на автора | 12345 |
| `parent_id` | integer | Нет | FK на родительский комментарий | null |
| `status` | varchar(20) | Да | Статус | created, deleted |

### Полиморфная связь

Комментарий привязывается к сущности через два поля:
- `source` — тип сущности ('blog', 'event', 'vacancy', 'techtask')
- `primary_key` — ID этой сущности

```sql
-- Все комментарии к блогу с id=100
SELECT * FROM core_comment
WHERE source = 'blog' AND primary_key = '100';
```

---

*Далее: [03_ER_DIAGRAMS.md](03_ER_DIAGRAMS.md) — ER-диаграммы*
