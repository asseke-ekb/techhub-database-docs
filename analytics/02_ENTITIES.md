# Ключевые сущности TechHub

## 1. ПОЛЬЗОВАТЕЛЬ (account_user)

### Бизнес-описание
Зарегистрированное физическое лицо на платформе TechHub. Пользователь может быть обычным посетителем, сотрудником компании, экспертом, модератором или администратором.

### Характеристики

| Атрибут | Тип | Обязательность | Бизнес-описание |
|---------|-----|----------------|-----------------|
| id | integer | PK | Уникальный идентификатор |
| email | varchar(400) | Нет | Email для входа. Может быть пустым при регистрации по телефону |
| phone | varchar(100) | Да | Номер телефона в формате +7XXXXXXXXXX |
| first_name | varchar(400) | Да | Имя пользователя |
| last_name | varchar(400) | Да | Фамилия пользователя |
| iin | varchar(100) | Нет | ИИН (индивидуальный идентификационный номер РК) |
| role | varchar(50) | Да | Системная роль. См. справочник |
| is_active | boolean | Да | Может ли пользователь входить в систему |
| blocked | boolean | Да | Заблокирован ли администратором |
| email_verified | boolean | Да | Подтверждён ли email |
| phone_verified | boolean | Да | Подтверждён ли телефон |
| is_staff | boolean | Да | Есть ли доступ в админ-панель |
| is_superuser | boolean | Да | Суперпользователь (все права) |
| created_at | timestamp | Да | Дата и время регистрации |
| last_login | timestamp | Нет | Последний вход в систему |
| company_id | FK | Нет | Основная компания пользователя |
| organization_id | FK | Нет | Организация (для сотрудников Astana Hub) |

### Теги пользователя

Теги хранятся в JSONB-полях и определяют категории пользователя:

| Тег | Поле | Описание | Как получить |
|-----|------|----------|--------------|
| Инвестор | tag_investor | Пользователь является инвестором | Заполнение профиля инвестора |
| IT-специалист | tag_it_specialist | IT-специалист | Заполнение профиля специалиста |
| Стажёр | tag_intern | Выпускник программы TechOrda | Завершение обучения TechOrda |
| Эксперт | tag_expert | Эксперт для оценки заявок | Назначение администратором |
| Член стартапа | tag_startup_member | Сотрудник стартапа | Членство в компании-стартапе |
| Член компании | tag_company_member | Сотрудник компании | Членство в компании |
| Студент | tag_student | Студент | Указание в профиле |
| Преподаватель | tag_teacher | Преподаватель | Указание в профиле |
| Учёный | tag_scientist | Научный работник | Указание в профиле |
| AI-специалист | tag_ai_specialist | Специалист по ИИ | Указание в профиле |

### Структура тега
```json
{
  "status": "active",        // active, inactive, pending
  "date_from": "2024-01-15", // Дата получения
  "date_to": null,           // Дата окончания (null = бессрочно)
  "data": {                  // Дополнительные данные
    "verified": true
  }
}
```

### Связи

| Связь | Таблица | Тип | Описание |
|-------|---------|-----|----------|
| Основная компания | account_company | N:1 | Компания по умолчанию |
| Членство в компаниях | account_usercompany | 1:N | Все компании пользователя |
| Заявки на услуги | service_servicerequest | 1:N | Поданные заявки |
| События (автор) | core_event | 1:N | Созданные события |
| Вакансии (автор) | core_vacancy | 1:N | Созданные вакансии |
| Блоги | core_blog | 1:N | Написанные блоги |
| Бронирования | booking_booking | 1:N | Бронирования |
| Отклики | core_vacancycandidate | 1:N | Отклики на вакансии |

### Бизнес-правила

1. **Регистрация:** Email ИЛИ телефон обязателен
2. **Активация:** Требуется подтверждение email/телефона
3. **Блокировка:** Заблокированный пользователь не может входить
4. **Удаление:** Пользователи не удаляются, только блокируются
5. **ИИН:** Используется для интеграции с eGov
6. **Роль:** Определяет системные права доступа

---

## 2. КОМПАНИЯ (account_company)

### Бизнес-описание
Юридическое лицо или индивидуальный предприниматель, зарегистрированный на платформе. Компания может получать статусы (IT-компания, стартап, резидент) и подавать заявки на услуги.

### Характеристики

| Атрибут | Тип | Обязательность | Бизнес-описание |
|---------|-----|----------------|-----------------|
| id | integer | PK | Уникальный идентификатор |
| name | varchar(1000) | Да | Полное наименование компании |
| short_name | varchar(200) | Нет | Краткое наименование |
| tin | varchar(12) | Нет | БИН/ИИН компании (12 цифр) |
| company_type | varchar(30) | Да | Тип: law (юр.лицо), ip (ИП), unknown |
| status | varchar(20) | Да | Статус: active, blocked |
| verified | boolean | Да | Прошла ли верификацию (проверка документов) |
| address | varchar(2000) | Нет | Юридический адрес |
| email | varchar(200) | Нет | Контактный email |
| phone | varchar(30) | Нет | Контактный телефон |
| website | varchar(1000) | Нет | Сайт компании |
| author_id | FK | Да | Кто создал компанию в системе |
| created_at | timestamp | Да | Дата регистрации |

### Банковские реквизиты

| Атрибут | Описание |
|---------|----------|
| bank | Название банка |
| iik | ИИК (расчётный счёт, 20 символов) |
| bik | БИК банка |
| kbe | КБе (код бенефициара) |

### Теги компании (статусы в экосистеме)

| Тег | Поле | Описание | Как получить |
|-----|------|----------|--------------|
| IT-компания | tag_it_company | Аккредитованная IT-компания | Услуга "Аккредитация" |
| Стартап | tag_startup | В реестре стартапов РК | Услуга "Реестр стартапов" |
| Резидент | tag_techpark | Резидент технопарка Astana Hub | Услуга "Резидентство" |
| Корп. партнёр | tag_corp_partner | Корпоративный партнёр | Соглашение с Astana Hub |
| НИИ | tag_nii | Научно-исследовательский институт | Регистрация как НИИ |
| Недропользователь | tag_nedrouser | Компания-недропользователь | Для НИОКР проектов |
| Tech Summit | tag_ts_member | Участник Tech Summit | Участие в мероприятии |

### Профильные данные (JSONB)

| Поле | Описание |
|------|----------|
| basic_info | Основная информация (год основания, размер, индустрия) |
| team | Информация о команде (количество, ключевые люди) |
| revenues | Данные о выручке по годам |
| investments | История привлечённых инвестиций |
| fundraising | Текущий раунд привлечения |
| expertise | Области экспертизы компании |
| customers_market | Целевые рынки и клиенты |
| product_market | Продукты и их рынки |

### Денормализованные счётчики

| Поле | Описание |
|------|----------|
| vacancies_count | Количество активных вакансий |
| upcoming_events_count | Количество предстоящих мероприятий |
| popularity_score | Рейтинг популярности (для сортировки) |
| profile_score | Процент заполненности профиля |

### Связи

| Связь | Таблица | Тип | Описание |
|-------|---------|-----|----------|
| Создатель | account_user | N:1 | Кто создал компанию |
| Сотрудники | account_usercompany | 1:N | Члены компании |
| Заявки | service_servicerequest | 1:N | Заявки от имени компании |
| События | core_event | 1:N | Организованные события |
| Вакансии | core_vacancy | 1:N | Размещённые вакансии |

### Бизнес-правила

1. **Создание:** Любой пользователь может создать компанию
2. **БИН:** Должен быть уникальным (если указан)
3. **Верификация:** Требует проверки документов модератором
4. **Владелец:** В компании ровно один owner (через account_usercompany)
5. **Теги:** Получаются через одобрение заявок на соответствующие услуги
6. **Блокировка:** Заблокированная компания не может подавать заявки

---

## 3. ЗАЯВКА НА УСЛУГУ (service_servicerequest)

### Бизнес-описание
Заявка пользователя или компании на получение услуги платформы (аккредитация, грант, резидентство и др.).

### Характеристики

| Атрибут | Тип | Обязательность | Бизнес-описание |
|---------|-----|----------------|-----------------|
| id | integer | PK | Уникальный идентификатор заявки |
| service_id | FK | Да | На какую услугу подана |
| author_id | FK | Да | Кто подал заявку |
| company_id | FK | Нет | От какой компании (если применимо) |
| status | varchar(30) | Да | Текущий статус заявки |
| created_at | timestamp | Да | Дата подачи |
| updated_at | timestamp | Да | Дата последнего изменения |
| data | jsonb | Нет | Дополнительные данные |

### Статусы заявки

| Статус | Код | Описание | Следующие статусы |
|--------|-----|----------|-------------------|
| Черновик | draft | Заявка создана, не отправлена | sent |
| Создана | created | Заявка создана (для некоторых услуг) | sent |
| На рассмотрении | sent | Отправлена на проверку | approved, correction, reject |
| На доработке | correction | Требуется исправление | sent |
| Одобрена | approved | Предварительно одобрена | success, reject |
| Успешно | success | Заявка полностью одобрена | — |
| Отклонена | reject/rejected | Заявка отклонена | — |

### Связи

| Связь | Таблица | Тип | Описание |
|-------|---------|-----|----------|
| Услуга | service_service | N:1 | Тип услуги |
| Автор | account_user | N:1 | Кто подал |
| Компания | account_company | N:1 | От чьего имени |
| Данные формы | service_hubformdata | 1:N | Заполненные поля |
| История статусов | service_servicerequeststatus | 1:N | Изменения статуса |
| Экспертизы | service_expertise | 1:N | Оценки экспертов |
| Отчёты | service_report | 1:N | Отчёты (для грантов) |

### Бизнес-правила

1. **Подача:** Пользователь должен быть авторизован
2. **Компания:** Для некоторых услуг обязательна компания
3. **Форма:** Заявка заполняется через динамическую форму
4. **Модерация:** Все заявки проходят проверку
5. **Экспертиза:** Некоторые услуги требуют оценки экспертов
6. **Результат:** Успешная заявка обновляет теги компании/пользователя

---

## 4. СОБЫТИЕ (core_event)

### Бизнес-описание
Мероприятие на платформе: митап, конференция, хакатон, воркшоп. Может быть организовано пользователем, компанией или Astana Hub.

### Характеристики

| Атрибут | Тип | Обязательность | Бизнес-описание |
|---------|-----|----------------|-----------------|
| id | integer | PK | Уникальный идентификатор |
| title | jsonb | Да | Название (мультиязычное: ru/kk/en) |
| content | jsonb | Нет | Описание (мультиязычное) |
| event_type | varchar(30) | Да | Тип: open_event, closed_event |
| event_format | varchar(30) | Да | Формат: astanahub, online, hybrid |
| status | varchar(30) | Да | Статус публикации |
| start_date | timestamp | Да | Дата и время начала |
| end_date | timestamp | Да | Дата и время окончания |
| author_id | FK | Да | Организатор (пользователь) |
| company_id | FK | Нет | Организатор (компания) |
| organization_id | FK | Нет | Организатор (Astana Hub и др.) |
| created_at | timestamp | Да | Дата создания |

### Мультиязычные поля

```json
{
  "ru": "Текст на русском",
  "kk": "Қазақша мәтін",
  "en": "English text"
}
```

### Связи

| Связь | Таблица | Тип | Описание |
|-------|---------|-----|----------|
| Автор | account_user | N:1 | Организатор |
| Компания | account_company | N:1 | Компания-организатор |
| Участники | core_eventparticipant | 1:N | Зарегистрированные участники |
| Комментарии | core_comment | 1:N | Комментарии к событию |

### Бизнес-правила

1. **Создание:** Пользователь или компания создаёт событие
2. **Модерация:** Событие проходит модерацию перед публикацией
3. **Регистрация:** Пользователи регистрируются как участники
4. **Закрытое событие:** Только по приглашениям
5. **Мультиязычность:** Название и описание на трёх языках

---

## 5. ВАКАНСИЯ (core_vacancy)

### Бизнес-описание
Вакансия от компании для поиска сотрудников.

### Характеристики

| Атрибут | Тип | Обязательность | Бизнес-описание |
|---------|-----|----------------|-----------------|
| id | integer | PK | Уникальный идентификатор |
| title | jsonb | Да | Название должности (мультиязычное) |
| content | jsonb | Нет | Описание вакансии |
| vacancy_type | varchar(30) | Да | Тип занятости |
| status | varchar(30) | Да | Статус публикации |
| salary_from | integer | Нет | Зарплата от |
| salary_to | integer | Нет | Зарплата до |
| experience | varchar(50) | Нет | Требуемый опыт |
| company_id | FK | Да | Компания-работодатель |
| author_id | FK | Да | Кто создал вакансию |
| created_at | timestamp | Да | Дата создания |

### Типы вакансий

| Тип | Код | Описание |
|-----|-----|----------|
| Полная занятость | fulltime | Полный рабочий день |
| Частичная | parttime | Неполный рабочий день |
| Стажировка | internship | Стажировка |
| Проект | project | Проектная работа |
| Волонтёрство | volunteering | Волонтёрская работа |
| Замещение | absense_period | Временная замена |

### Связи

| Связь | Таблица | Тип | Описание |
|-------|---------|-----|----------|
| Компания | account_company | N:1 | Работодатель |
| Автор | account_user | N:1 | Кто создал |
| Кандидаты | core_vacancycandidate | 1:N | Отклики |

### Бизнес-правила

1. **Компания обязательна:** Вакансия всегда от компании
2. **Модерация:** Проходит проверку перед публикацией
3. **Отклики:** Пользователи могут откликаться

---

## 6. БРОНИРОВАНИЕ (booking_booking)

### Бизнес-описание
Бронирование переговорной комнаты или рабочего места в технопарке.

### Характеристики

| Атрибут | Тип | Обязательность | Бизнес-описание |
|---------|-----|----------------|-----------------|
| id | integer | PK | Уникальный идентификатор |
| room_id | FK | Да | Какая комната |
| user_id | FK | Да | Кто бронирует |
| start_time | timestamp | Да | Начало бронирования |
| end_time | timestamp | Да | Окончание бронирования |
| status | varchar(20) | Да | Статус: active, finished, deactivated |
| created_at | timestamp | Да | Дата создания |

### Статусы

| Статус | Код | Описание |
|--------|-----|----------|
| Активное | active | Бронирование подтверждено |
| Завершено | finished | Время прошло |
| Отменено | deactivated | Отменено пользователем |

### Бизнес-правила

1. **Пересечение:** Время не может пересекаться с другими бронированиями
2. **Отмена:** Можно отменить до начала
3. **Автозавершение:** Статус меняется на finished после окончания времени

---

## 7. БЛОГ (core_blog)

### Бизнес-описание
Публикация пользователя или компании на платформе.

### Характеристики

| Атрибут | Тип | Обязательность | Бизнес-описание |
|---------|-----|----------------|-----------------|
| id | integer | PK | Уникальный идентификатор |
| title | jsonb | Да | Заголовок (мультиязычное) |
| content | jsonb | Да | Содержание |
| status | varchar(30) | Да | Статус публикации |
| author_id | FK | Да | Автор |
| company_id | FK | Нет | Компания (если от имени компании) |
| created_at | timestamp | Да | Дата создания |

### Бизнес-правила

1. **Модерация:** Проходит проверку перед публикацией
2. **Автор:** Пользователь или компания
3. **Комментарии:** Пользователи могут комментировать

---

## Следующий раздел

[03_DICTIONARIES.md](03_DICTIONARIES.md) — Справочники значений
