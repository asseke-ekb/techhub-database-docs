# Бизнес-процессы TechHub

## 1. Регистрация и аутентификация

### 1.1 Регистрация пользователя

**Участники:** Пользователь, Система

**Входные данные:** Email или телефон, пароль, имя, фамилия

**Процесс:**

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Заполнение │────→│  Отправка   │────→│Подтверждение│────→│   Аккаунт   │
│    формы    │     │    кода     │     │    кода     │     │   активен   │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

**Шаги:**
1. Пользователь заполняет форму регистрации
2. Система проверяет уникальность email/телефона
3. Система создаёт запись в `account_user` с `is_active=false`
4. Система создаёт код активации в `account_activation` (type=registration)
5. Система отправляет код на email/телефон
6. Пользователь вводит код
7. Система активирует аккаунт (`is_active=true`, `email_verified=true`)

**Таблицы:**
- `account_user` — создаётся запись пользователя
- `account_activation` — код подтверждения

**Бизнес-правила:**
- Email или телефон обязателен (один из двух)
- Email/телефон должен быть уникальным
- Код активации действителен 10 минут
- Максимум 3 попытки ввода кода

---

### 1.2 Регистрация компании

**Участники:** Пользователь, Модератор

**Входные данные:** БИН/ИИН, название, тип компании, реквизиты

**Процесс:**

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Заполнение │────→│  Компания   │────→│ Верификация │────→│  Компания   │
│    формы    │     │   создана   │     │ модератором │     │верифицирована│
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

**Шаги:**
1. Пользователь заполняет данные компании
2. Система создаёт запись в `account_company` с `verified=false`
3. Система создаёт связь `account_usercompany` с `role=owner`
4. Модератор проверяет документы
5. Модератор устанавливает `verified=true`

**Таблицы:**
- `account_company` — создаётся компания
- `account_usercompany` — связь пользователь-компания

**Бизнес-правила:**
- БИН должен быть уникальным (если указан)
- Создатель автоматически становится владельцем (owner)
- В компании может быть только один owner

---

## 2. Управление членством в компании

### 2.1 Приглашение в компанию

**Участники:** Владелец компании, Приглашённый пользователь

**Процесс:**

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ Владелец    │────→│ Приглашение │────→│  Пользователь│────→│   Членство  │
│ отправляет  │     │   создано   │     │  принимает  │     │   создано   │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

**Шаги:**
1. Владелец создаёт приглашение с указанием роли
2. Система создаёт запись в `account_usercompanyinvitation` (status=pending)
3. Приглашённый получает уведомление
4. Приглашённый принимает/отклоняет
5. При принятии создаётся запись в `account_usercompany`

**Таблицы:**
- `account_usercompanyinvitation` — приглашение
- `account_usercompany` — членство (при принятии)

---

### 2.2 Заявка на вступление

**Участники:** Пользователь, Владелец компании

**Процесс:**

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ Пользователь│────→│   Заявка    │────→│  Владелец   │────→│   Членство  │
│   подаёт    │     │   создана   │     │  одобряет   │     │   создано   │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

**Шаги:**
1. Пользователь подаёт заявку на вступление
2. Система создаёт запись в `account_usercompanyrequest` (status=pending)
3. Владелец получает уведомление
4. Владелец одобряет/отклоняет
5. При одобрении создаётся запись в `account_usercompany`

**Таблицы:**
- `account_usercompanyrequest` — заявка
- `account_usercompany` — членство (при одобрении)

---

## 3. Подача заявки на услугу

### 3.1 Общий процесс подачи заявки

**Участники:** Пользователь/Компания, Модератор, Эксперт (опционально)

**Процесс:**

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌──────────┐     ┌─────────┐
│Черновик │────→│Отправлено│───→│ Проверка│────→│Экспертиза│────→│ Решение │
│ (draft) │     │  (sent)  │    │модератор│     │(если нужна)│   │(success/│
└─────────┘     └─────────┘     └────┬────┘     └──────────┘     │ reject) │
                                     │                           └─────────┘
                                     │ доработка
                                     ▼
                              ┌───────────┐
                              │correction │
                              └───────────┘
```

**Шаги:**
1. Пользователь выбирает услугу из каталога (`service_service`)
2. Система загружает форму заявки (`service_hubform`, `service_hubformfield`)
3. Пользователь заполняет форму (данные в `service_hubformdata`)
4. Пользователь отправляет заявку (status: draft → sent)
5. Модератор проверяет заявку
6. **Вариант А:** Одобрение → status: approved/success
7. **Вариант Б:** Доработка → status: correction → пользователь исправляет
8. **Вариант В:** Отклонение → status: reject
9. Для некоторых услуг — экспертиза (голосование в `service_expertise`)
10. Финальное решение фиксируется в протоколе (`service_protocol`)

**Таблицы:**
- `service_service` — каталог услуг
- `service_servicerequest` — заявка
- `service_hubform` — шаблон формы
- `service_hubformfield` — поля формы
- `service_hubformdata` — заполненные данные
- `service_servicerequeststatus` — история статусов
- `service_expertise` — экспертные оценки
- `service_protocol` — протоколы решений

---

### 3.2 Аккредитация IT-компании

**Участники:** Компания, Модератор

**Результат:** Тег `tag_it_company` на компании

**Специфика:**
- Заявитель должен быть владельцем компании
- Требуются документы: устав, свидетельство о регистрации
- Проверяется соответствие критериям IT-компании
- При успехе — компания получает `tag_it_company.status = 'active'`

---

### 3.3 Включение в реестр стартапов

**Участники:** Компания, Модератор, Эксперты

**Результат:** Тег `tag_startup` на компании

**Специфика:**
- Требуется описание продукта, команды, бизнес-модели
- Проходит экспертизу (оценка несколькими экспертами)
- Решение принимается комиссией (протокол)
- При успехе — компания получает `tag_startup.status = 'active'`

---

### 3.4 Грант Seed Money

**Участники:** Стартап, Модератор, Эксперты, Комиссия

**Результат:** Финансирование + обязательная отчётность

**Процесс:**

```
┌─────────┐     ┌─────────┐     ┌──────────┐     ┌─────────┐     ┌─────────┐
│ Заявка  │────→│Экспертиза│───→│ Питчинг  │────→│ Комиссия│────→│  Грант  │
│         │     │          │    │          │     │         │     │ выдан   │
└─────────┘     └─────────┘     └──────────┘     └─────────┘     └────┬────┘
                                                                      │
                                                                      ▼
                                                               ┌──────────┐
                                                               │Отчётность│
                                                               │периодич. │
                                                               └──────────┘
```

**Специфика:**
- Только для стартапов (`tag_startup`)
- Многоэтапная экспертиза
- Питчинг перед комиссией (оценки в `service_pitchinggrade`)
- Периодическая отчётность (`service_seedmoneyreport`)

---

## 4. Публикация контента

### 4.1 Создание события

**Участники:** Организатор (пользователь/компания), Модератор

**Процесс:**

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌──────────┐
│Создание │────→│Черновик │────→│Модерация│────→│Опубликовано│
│         │     │ (draft) │     │ (sent)  │     │ (success) │
└─────────┘     └─────────┘     └─────────┘     └──────────┘
```

**Шаги:**
1. Организатор заполняет форму события
2. Система создаёт запись в `core_event` (status=draft)
3. Организатор отправляет на модерацию (status=sent)
4. Модератор проверяет контент
5. При одобрении — публикация (status=success)
6. Событие появляется в ленте, пользователи могут регистрироваться

**Таблицы:**
- `core_event` — событие
- `core_eventparticipant` — участники

**Бизнес-правила:**
- Обязательны: название, дата начала/окончания, формат
- Мультиязычный контент (ru/kk/en)
- Закрытое событие — только по приглашениям

---

### 4.2 Публикация вакансии

**Участники:** Компания, Модератор

**Процесс:** Аналогичен событиям

**Специфика:**
- Обязательна привязка к компании
- Указывается тип занятости, зарплата, требования
- Пользователи могут откликаться (`core_vacancycandidate`)

---

### 4.3 Отклик на вакансию

**Участники:** Кандидат, Компания

**Процесс:**

```
┌─────────┐     ┌─────────┐     ┌──────────┐
│ Отклик  │────→│Рассмотр.│────→│  Решение │
│         │     │компанией│     │          │
└─────────┘     └─────────┘     └──────────┘
```

**Шаги:**
1. Кандидат просматривает вакансию
2. Кандидат отправляет отклик (резюме, сопроводительное письмо)
3. Система создаёт запись в `core_vacancycandidate`
4. Компания получает уведомление
5. Компания рассматривает отклик
6. Компания связывается с кандидатом (вне системы)

**Таблицы:**
- `core_vacancy` — вакансия
- `core_vacancycandidate` — отклик

---

## 5. Бронирование

### 5.1 Бронирование переговорной

**Участники:** Пользователь

**Процесс:**

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌──────────┐
│ Выбор   │────→│ Выбор   │────→│Подтверж.│────→│Бронь актив│
│ комнаты │     │ времени │     │         │     │ (active)  │
└─────────┘     └─────────┘     └─────────┘     └──────────┘
```

**Шаги:**
1. Пользователь выбирает комнату из каталога (`booking_room`)
2. Пользователь просматривает расписание (существующие брони)
3. Пользователь выбирает свободный слот
4. Система проверяет отсутствие пересечений
5. Система создаёт запись в `booking_booking` (status=active)
6. Пользователь получает подтверждение

**Таблицы:**
- `booking_room` — комнаты
- `booking_booking` — бронирования
- `booking_worktime` — рабочее время комнат

**Бизнес-правила:**
- Время бронирования не может пересекаться
- Бронирование возможно в рамках рабочего времени комнаты
- Можно отменить до начала (status → deactivated)
- После окончания времени автоматически status → finished

---

## 6. Образовательные программы (TechOrda)

### 6.1 Заявка на обучение

**Участники:** Кандидат, Менеджер TechOrda

**Процесс:**

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ Заявка  │────→│ Отбор   │────→│Зачисление│───→│ Обучение│────→│Выпускник│
│         │     │         │     │          │    │         │     │(tag_intern)│
└─────────┘     └─────────┘     └─────────┘     └─────────┘     └─────────┘
```

**Шаги:**
1. Кандидат подаёт заявку через услугу `techorda_request`
2. Менеджер отбирает кандидатов
3. Кандидат зачисляется в поток (`techorda_stream`)
4. Создаётся запись студента (`service_techordastudent`)
5. Студент проходит обучение
6. По завершении — тег `tag_intern` на пользователе

**Таблицы:**
- `service_servicerequest` — заявка
- `techorda_program` — программа
- `techorda_stream` — поток
- `service_techordastudent` — студент
- `service_techordareport` — отчёты по программе

---

## 7. НИОКР проекты

### 7.1 Регистрация НИОКР проекта

**Участники:** Компания-недропользователь, Администратор НИОКР

**Специфика:**
- Только для компаний с тегом `tag_nedrouser`
- Требуется техническое задание
- Экспертиза проекта
- Периодическая отчётность

**Таблицы:**
- `niokr_project` — проект
- `niokr_request` — заявка
- `niokr_report` — отчёты

---

## Матрица процессов и ролей

| Процесс | Инициатор | Исполнитель | Результат |
|---------|-----------|-------------|-----------|
| Регистрация пользователя | Пользователь | Система | account_user |
| Регистрация компании | Пользователь | Модератор | account_company |
| Аккредитация IT | Компания | Модератор | tag_it_company |
| Реестр стартапов | Компания | Эксперты, Комиссия | tag_startup |
| Резидентство | Компания | Модератор | tag_techpark |
| Грант Seed Money | Стартап | Эксперты, Комиссия | Финансирование |
| Публикация события | Организатор | Модератор | core_event |
| Публикация вакансии | Компания | Модератор | core_vacancy |
| Бронирование | Пользователь | Система | booking_booking |
| Обучение TechOrda | Кандидат | Менеджер | tag_intern |

---

## Следующий раздел

[05_DATA_MODEL.md](05_DATA_MODEL.md) — Модель данных
