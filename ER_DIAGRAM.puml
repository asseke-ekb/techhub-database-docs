@startuml TechHub_ER_Diagram

!define TABLE(name) entity name << (T,#FFAAAA) >>
!define PRIMARY_KEY(x) <b><u>x</u></b>
!define FOREIGN_KEY(x) <i>x</i>

skinparam linetype ortho
skinparam padding 5
skinparam nodesep 50
skinparam ranksep 50

title TechHub Database - ER Diagram

' ==================== ACCOUNT MODULE ====================
package "Account Module" #LightBlue {
    TABLE(account_user) {
        PRIMARY_KEY(id) : integer
        --
        email : varchar(400)
        phone : varchar(100)
        first_name : varchar(400)
        last_name : varchar(400)
        role : varchar(50)
        is_active : boolean
        is_staff : boolean
        --
        FOREIGN_KEY(company_id) : integer
        FOREIGN_KEY(organization_id) : varchar(20)
        --
        tags : jsonb
        permissions : jsonb
        tag_investor : jsonb
        tag_expert : jsonb
        tag_it_specialist : jsonb
    }

    TABLE(account_company) {
        PRIMARY_KEY(id) : integer
        --
        tin : varchar(12)
        name : varchar(1000)
        short_name : varchar(200)
        company_type : varchar(30)
        status : varchar(20)
        verified : boolean
        --
        FOREIGN_KEY(author_id) : integer
        --
        tag_startup : jsonb
        tag_it_company : jsonb
        tag_techpark : jsonb
        description : text
        website : varchar(1000)
    }

    TABLE(account_usercompany) {
        PRIMARY_KEY(id) : integer
        --
        FOREIGN_KEY(user_id) : integer
        FOREIGN_KEY(company_id) : integer
        role : varchar(20)
        verified : boolean
    }

    TABLE(account_activation) {
        PRIMARY_KEY(uuid) : uuid
        --
        email : varchar(200)
        phone : varchar(20)
        code : varchar(6)
        type : varchar(30)
        is_active : boolean
        FOREIGN_KEY(user_id) : integer
    }
}

' ==================== CORE MODULE ====================
package "Core Module" #LightGreen {
    TABLE(core_organization) {
        PRIMARY_KEY(code) : varchar(20)
        --
        name : jsonb
        data : jsonb
        active : boolean
        logo : varchar(100)
    }

    TABLE(core_event) {
        PRIMARY_KEY(id) : integer
        --
        title : jsonb
        content : jsonb
        status : varchar(20)
        event_type : varchar(20)
        event_format : varchar(20)
        datetime_start : timestamp
        datetime_end : timestamp
        published : boolean
        --
        FOREIGN_KEY(author_id) : integer
        FOREIGN_KEY(company_id) : integer
        FOREIGN_KEY(organization_id) : varchar(20)
    }

    TABLE(core_eventparticipant) {
        PRIMARY_KEY(id) : integer
        --
        full_name : varchar(200)
        email : varchar(200)
        phone : varchar(200)
        status : varchar(20)
        qrcode : varchar(20)
        --
        FOREIGN_KEY(event_id) : integer
        FOREIGN_KEY(author_id) : integer
    }

    TABLE(core_vacancy) {
        PRIMARY_KEY(id) : integer
        --
        title : jsonb
        description : jsonb
        status : varchar(20)
        vacancy_type : varchar(20)
        salary_min : integer
        salary_max : integer
        published : boolean
        --
        FOREIGN_KEY(author_id) : integer
        FOREIGN_KEY(company_id) : integer
        FOREIGN_KEY(city_id) : integer
    }

    TABLE(core_vacancycandidate) {
        PRIMARY_KEY(id) : integer
        --
        status : varchar(20)
        --
        FOREIGN_KEY(vacancy_id) : integer
        FOREIGN_KEY(author_id) : integer
    }

    TABLE(core_blog) {
        PRIMARY_KEY(id) : integer
        --
        title : jsonb
        content : jsonb
        status : varchar(20)
        published : boolean
        slug : varchar(250)
        --
        FOREIGN_KEY(author_id) : integer
        FOREIGN_KEY(company_id) : integer
        FOREIGN_KEY(category_id) : integer
    }

    TABLE(core_category) {
        PRIMARY_KEY(id) : integer
        --
        name : jsonb
        slug : varchar(250)
        is_active : boolean
        featured : boolean
    }

    TABLE(core_techtask) {
        PRIMARY_KEY(id) : integer
        --
        title : jsonb
        description : jsonb
        status : varchar(20)
        published : boolean
        slug : varchar(250)
        --
        FOREIGN_KEY(author_id) : integer
    }

    TABLE(core_techtasksolution) {
        PRIMARY_KEY(id) : integer
        --
        company_name : jsonb
        status : varchar(20)
        --
        FOREIGN_KEY(tech_task_id) : integer
        FOREIGN_KEY(author_id) : integer
    }

    TABLE(core_comment) {
        PRIMARY_KEY(id) : integer
        --
        message : text
        source : varchar(50)
        primary_key : varchar(20)
        status : varchar(20)
        --
        FOREIGN_KEY(user_id) : integer
        FOREIGN_KEY(parent_id) : integer
    }

    TABLE(core_infrastructure) {
        PRIMARY_KEY(id) : integer
        --
        name : jsonb
        type : varchar(100)
        status : varchar(20)
        active : boolean
        --
        FOREIGN_KEY(author_id) : integer
        FOREIGN_KEY(company_id) : integer
        FOREIGN_KEY(organization_id) : varchar(20)
    }
}

' ==================== SERVICE MODULE ====================
package "Service Module" #LightYellow {
    TABLE(service_service) {
        PRIMARY_KEY(code) : varchar
        --
        data : jsonb
        --
        FOREIGN_KEY(organization_id) : varchar(20)
        FOREIGN_KEY(hub_form_id) : integer
        FOREIGN_KEY(page_id) : integer
    }

    TABLE(service_servicerequest) {
        PRIMARY_KEY(id) : integer
        --
        status : varchar(20)
        created_at : timestamp
        --
        FOREIGN_KEY(service_id) : varchar
        FOREIGN_KEY(author_id) : integer
        FOREIGN_KEY(company_id) : integer
        FOREIGN_KEY(assignee_id) : integer
        FOREIGN_KEY(expert_id) : integer
        FOREIGN_KEY(hub_form_data_id) : integer
        FOREIGN_KEY(parent_id) : integer
    }

    TABLE(service_hubform) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(organization_id) : varchar(20)
    }

    TABLE(service_hubformdata) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(hub_form_id) : integer
    }

    TABLE(service_hubformstep) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(hub_form_id) : integer
    }

    TABLE(service_hubformfield) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(hub_form_step_id) : integer
    }

    TABLE(service_expertise) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(service_request_id) : integer
        FOREIGN_KEY(user_id) : integer
    }

    TABLE(service_report) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(service_request_id) : integer
        FOREIGN_KEY(author_id) : integer
    }

    TABLE(service_protocol) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(service_id) : varchar
    }
}

' ==================== BOOKING MODULE ====================
package "Booking Module" #LightPink {
    TABLE(booking_room) {
        PRIMARY_KEY(id) : integer
        --
        name : varchar(50)
        floor : smallint
        max_people : smallint
        pavilion : varchar(10)
        is_active : boolean
    }

    TABLE(booking_booking) {
        PRIMARY_KEY(id) : integer
        --
        status : varchar(20)
        title : varchar(100)
        start : timestamp
        end : timestamp
        --
        FOREIGN_KEY(room_id) : integer
        FOREIGN_KEY(author_id) : integer
        FOREIGN_KEY(company_id) : integer
    }

    TABLE(booking_bookingstatus) {
        PRIMARY_KEY(id) : integer
        --
        status : varchar(20)
        comment : varchar(200)
        --
        FOREIGN_KEY(booking_id) : integer
    }
}

' ==================== TECHORDA MODULE ====================
package "TechOrda Module" #LightCyan {
    TABLE(techorda_school) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(author_id) : integer
        FOREIGN_KEY(company_id) : integer
    }

    TABLE(techorda_course) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(school_id) : integer
        FOREIGN_KEY(flow_id) : integer
    }

    TABLE(techorda_flow) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
    }

    TABLE(techorda_courseapplication) {
        PRIMARY_KEY(id) : integer
        --
        FOREIGN_KEY(course_id) : integer
        FOREIGN_KEY(flow_id) : integer
        FOREIGN_KEY(application_form_id) : integer
    }
}

' ==================== LANDING MODULE ====================
package "Landing Module" #Wheat {
    TABLE(landing_page) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(author_id) : integer
        FOREIGN_KEY(organization_id) : varchar(20)
    }

    TABLE(landing_section) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(page_id) : integer
    }

    TABLE(landing_component) {
        PRIMARY_KEY(id) : integer
        --
        data : jsonb
        --
        FOREIGN_KEY(section_id) : integer
    }
}

' ==================== RELATIONSHIPS ====================

' Account relationships
account_user }o--|| account_company : "primary company"
account_user }o--|| core_organization : "organization"
account_user ||--o{ account_usercompany : "memberships"
account_company ||--o{ account_usercompany : "members"
account_activation }o--|| account_user : "activates"

' Core relationships
core_event }o--|| account_user : "author"
core_event }o--|| account_company : "company"
core_event }o--|| core_organization : "organization"
core_event ||--o{ core_eventparticipant : "participants"
core_eventparticipant }o--|| account_user : "user"

core_vacancy }o--|| account_user : "author"
core_vacancy }o--|| account_company : "company"
core_vacancy ||--o{ core_vacancycandidate : "candidates"
core_vacancycandidate }o--|| account_user : "candidate"

core_blog }o--|| account_user : "author"
core_blog }o--|| account_company : "company"
core_blog }o--|| core_category : "category"

core_techtask }o--|| account_user : "author"
core_techtask ||--o{ core_techtasksolution : "solutions"
core_techtasksolution }o--|| account_user : "author"

core_comment }o--|| account_user : "author"
core_comment }o--o| core_comment : "parent"

core_infrastructure }o--|| account_user : "author"
core_infrastructure }o--|| account_company : "company"

' Service relationships
service_service }o--|| core_organization : "organization"
service_service }o--|| service_hubform : "form"
service_service }o--|| landing_page : "landing"
service_service ||--o{ service_servicerequest : "requests"

service_servicerequest }o--|| account_user : "author"
service_servicerequest }o--|| account_company : "company"
service_servicerequest }o--|| account_user : "assignee"
service_servicerequest }o--|| service_hubformdata : "form data"
service_servicerequest ||--o{ service_expertise : "expertises"
service_servicerequest ||--o{ service_report : "reports"

service_hubform ||--o{ service_hubformdata : "submissions"
service_hubform ||--o{ service_hubformstep : "steps"
service_hubformstep ||--o{ service_hubformfield : "fields"

service_expertise }o--|| account_user : "expert"
service_report }o--|| account_user : "author"
service_protocol }o--|| service_service : "service"

' Booking relationships
booking_room ||--o{ booking_booking : "bookings"
booking_booking }o--|| account_user : "author"
booking_booking }o--|| account_company : "company"
booking_booking ||--o{ booking_bookingstatus : "statuses"

' TechOrda relationships
techorda_school }o--|| account_user : "author"
techorda_school }o--|| account_company : "company"
techorda_school ||--o{ techorda_course : "courses"
techorda_flow ||--o{ techorda_course : "courses"
techorda_course ||--o{ techorda_courseapplication : "applications"

' Landing relationships
landing_page }o--|| account_user : "author"
landing_page }o--|| core_organization : "organization"
landing_page ||--o{ landing_section : "sections"
landing_section ||--o{ landing_component : "components"

@enduml
